@* Views/Student/ViewAnalysisResult.cshtml *@
@model YetenekPusulasi.Core.Entities.AnalysisResult
@using YetenekPusulasi.WebApp.Helpers // MarkdownHelper için (namespace'inizi kontrol edin)

@{
    ViewData["Title"] = "Cevap Analiz Sonucunuz";
    var scenarioTitle = Model.StudentAnswer?.Scenario?.Title ?? "Bilinmeyen Senaryo";
    var studentAnswerText = Model.StudentAnswer?.AnswerText ?? "Cevap metni bulunamadı.";
}

<h4>"@scenarioTitle" Senaryosu İçin Analiz Sonucunuz</h4>
<hr />

@if (!string.IsNullOrEmpty(Model.ErrorMessage))
{
    <div class="alert alert-danger" role="alert">
        <strong>Analiz Hatası:</strong> @Model.ErrorMessage
    </div>
}

@* ... (Senaryo ve Cevap kartı aynı kalabilir) ... *@
<div class="card mb-3">
    <div class="card-header">Senaryo ve Verdiğiniz Cevap</div>
    <div class="card-body">
        <h5 class="card-title">Senaryo: @scenarioTitle</h5>
        <p class="card-text"><em>@Model.StudentAnswer?.Scenario?.Description</em></p>
        <hr>
        <h6 class="card-subtitle mb-2 text-muted">Verdiğiniz Cevap (@Model.StudentAnswer?.SubmissionDate.ToShortDateString()):</h6>
        <p class="card-text" style="white-space: pre-wrap;">@studentAnswerText</p>
    </div>
</div>


<div class="card">
    <div class="card-header bg-primary text-white">Yapay Zeka Analizi (@Model.AiModelUsed)</div>
    <div class="card-body">
        <h5 class="card-title">Özet Değerlendirme</h5>
        @* --- MARKDOWN GÖSTERİMİ --- *@
        <div class="markdown-content">
            @Html.Raw(MarkdownHelper.Parse(Model.Summary)) @* Model.Summary'nin markdown içerdiğini varsayıyoruz *@
        </div>
        @* --- MARKDOWN GÖSTERİMİ BİTTİ --- *@
        
        @if (Model.OverallScore.HasValue)
        {
            <h6 class="mt-3">Genel Skor: <span class="badge bg-info">@Model.OverallScore.Value.ToString("P0")</span></h6>
        }

        @if (Model.DetectedSkills != null && Model.DetectedSkills.Any())
        {
            <h6 class="mt-3">Tespit Edilen Yetenekler/Noktalar:</h6>
            <ul class="list-group list-group-flush">
                @foreach (var skill in Model.DetectedSkills)
                {
                    <li class="list-group-item px-0">@skill</li> @* px-0 ile list-group padding'ini sıfırla *@
                }
            </ul>
        }

        @if (!string.IsNullOrWhiteSpace(Model.RawAiResponse))
{
    bool showRawToStudent = true; // VEYA bir ayardan/rol kontrolünden gelsin
    if (showRawToStudent) // Admin her zaman görsün, öğrenci için de flag'e bağlı
    {
        <div class="mt-4">
            <h6>
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#rawAiResponseCollapse" role="button" aria-expanded="false" aria-controls="rawAiResponseCollapse">
                    <i class="bi bi-chevron-down"></i> Yapay Zeka Detaylı Çıktısı (Ham Veri)
                </a>
            </h6>
            <div class="collapse" id="rawAiResponseCollapse">
                <div class="card card-body bg-light mt-2">
                    @* Eğer RawAiResponse'un da markdown olduğunu varsayıyorsak: *@
                    <div class="markdown-content-raw">
                         @Html.Raw(MarkdownHelper.Parse(Model.RawAiResponse))
                    </div>
                    @* Eğer RawAiResponse sadece düz metin ve satır sonları önemliyse: *@
                    @* <pre style="white-space: pre-wrap; word-break: break-all; max-height: 400px; overflow-y: auto;"><code>@Model.RawAiResponse</code></pre> *@
                </div>
            </div>
        </div>
    }
}
@* --- HAM AI CEVABI BİTTİ --- *@
    </div>
    <div class="card-footer text-muted">
        Analiz Tarihi: @Model.AnalysisDate.ToString("g")
    </div>
</div>

@* ... (Geri dönüş linkleri) ... *@

<div class="mt-3">
    <a asp-action="ViewClassroomScenarios" asp-route-classroomId="@Model.StudentAnswer?.Scenario?.ClassroomId" class="btn btn-outline-secondary">Sınıf Senaryolarına Geri Dön</a>
    <a asp-action="Dashboard" class="btn btn-info">Öğrenci Paneline Dön</a>
</div>