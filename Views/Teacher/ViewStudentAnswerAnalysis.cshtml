@* Views/Teacher/ViewStudentAnswerAnalysis.cshtml *@
@model YetenekPusulasi.Core.Entities.AnalysisResult
@using YetenekPusulasi.WebApp.Helpers // MarkdownHelper için

@{
    var studentUserName = Model.StudentAnswer?.Student?.UserName ?? "Bilinmeyen Öğrenci";
    var scenarioTitle = Model.StudentAnswer?.Scenario?.Title ?? "Bilinmeyen Senaryo";
    ViewData["Title"] = $"{studentUserName} - '{scenarioTitle}' Analizi";
}

<h4>@ViewData["Title"]</h4>
<hr />

@if (!string.IsNullOrEmpty(Model.ErrorMessage))
{
    <div class="alert alert-danger" role="alert">
        <strong>Analiz Hatası:</strong> @Model.ErrorMessage
    </div>
}

@* ... (Öğrenci Cevabı Kartı aynı kalabilir) ... *@
<div class="card mb-3">
    <div class="card-header">
        Öğrenci: <strong>@studentUserName</strong> - Senaryo: <strong>@scenarioTitle</strong>
    </div>
    <div class="card-body">
        <h6 class="card-subtitle mb-2 text-muted">Öğrencinin Cevabı (@Model.StudentAnswer?.SubmissionDate.ToShortDateString()):</h6>
        <p class="card-text bg-light p-2 rounded" style="white-space: pre-wrap;">@(Model.StudentAnswer?.AnswerText ?? "Cevap metni bulunamadı.")</p>
    </div>
</div>

<div class="card">
    <div class="card-header bg-success text-white">Yapay Zeka Analizi (@Model.AiModelUsed)</div>
    <div class="card-body">
        <h5 class="card-title">Özet Değerlendirme</h5>
        @* --- MARKDOWN GÖSTERİMİ --- *@
        <div class="markdown-content">
            @Html.Raw(MarkdownHelper.Parse(Model.Summary))
        </div>
        @* --- MARKDOWN GÖSTERİMİ BİTTİ --- *@

        @if (Model.OverallScore.HasValue)
        {
            <h6 class="mt-3">Genel Skor: <span class="badge bg-info">@Model.OverallScore.Value.ToString("P0")</span></h6>
        }

        @if (Model.DetectedSkills != null && Model.DetectedSkills.Any())
        {
            <h6 class="mt-3">Tespit Edilen Yetenekler/Noktalar:</h6>
            <ul class="list-group list-group-flush">
                @foreach (var skill in Model.DetectedSkills)
                {
                    <li class="list-group-item px-0">@skill</li>
                }
            </ul>
        }
        
       <div class="mt-4">
            <h6>
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#rawAiResponseCollapse" role="button" aria-expanded="false" aria-controls="rawAiResponseCollapse">
                    <i class="bi bi-chevron-down"></i> Yapay Zeka Detaylı Çıktısı (Ham Veri)
                </a>
            </h6>
            <div class="collapse" id="rawAiResponseCollapse">
                <div class="card card-body bg-light mt-2">
                    @* Eğer RawAiResponse'un da markdown olduğunu varsayıyorsak: *@
                    <div class="markdown-content-raw">
                         @Html.Raw(MarkdownHelper.Parse(Model.RawAiResponse))
                    </div>
                    @* Eğer RawAiResponse sadece düz metin ve satır sonları önemliyse: *@
                    @* <pre style="white-space: pre-wrap; word-break: break-all; max-height: 400px; overflow-y: auto;"><code>@Model.RawAiResponse</code></pre> *@
                </div>
            </div>
        </div>
    </div>
    <div class="card-footer text-muted">
        Analiz Tarihi: @Model.AnalysisDate.ToString("g")
    </div>
</div>


<div class="mt-3">
    <a asp-action="ClassroomDetails" asp-route-id="@Model.StudentAnswer?.Scenario?.ClassroomId" class="btn btn-outline-secondary">Sınıf Detaylarına Geri Dön</a>
    <a asp-action="Dashboard" class="btn btn-info">Öğretmen Paneline Dön</a>
</div>